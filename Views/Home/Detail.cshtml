@using System.Security.Claims
@model EmployeeApp.Models.Employee

@{
    ViewData["Title"] = "Detail";
}

<div class="container mt-4">
    <h2>社員詳細: @Model.EmployeeName</h2>
    <hr>

    <div class="card mb-4">
        <div class="card-header">
            <h4>基本情報</h4>
        </div>
        <div class="card-body">
            <p><strong>社員ID:</strong> @Model.Id</p>
            <p><strong>氏名:</strong> @Model.EmployeeName</p>
            <p><strong>登録日:</strong> @Model.CreatedAt?.ToString("yyyy年MM月dd日")</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h4>所属部署・課</h4>
        </div>
        <div class="card-body">
            @{
                var currentDepartmentIds = Model.Departments.Select(d => d.Id).ToList();
                var currentDivisionIds = Model.Divisions.Select(d => d.Id).ToList();
            }
            
            @foreach (var dept in ViewBag.AllDepartments)
            {
                <div class="mb-4">
                    <div class="form-check mb-2">
                        <input class="form-check-input" 
                               type="checkbox" 
                               id="dept_@dept.Id"
                               style="pointer-events: none;"
                               @(currentDepartmentIds.Contains(dept.Id) ? "checked" : "") />
                        <label class="form-check-label fw-bold" for="dept_@dept.Id" style="pointer-events: none;">
                            @dept.DepartmentName
                        </label>
                    </div>
                    
                    <div class="row ms-3">
                        @foreach (var division in dept.Divisions)
                        {
                            <div class="col-md-4 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" 
                                           type="checkbox" 
                                           id="div_@division.Id"
                                           style="pointer-events: none;"
                                           @(currentDivisionIds.Contains(division.Id) ? "checked" : "") />
                                    <label class="form-check-label" for="div_@division.Id" style="pointer-events: none;">
                                        @division.DivisionName
                                    </label>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>


    <div class="card mb-4">
        <div class="card-header">
            <h4>保有資格</h4>
        </div>
        <div class="card-body">
            @if (Model.Licenses?.Any() == true)
            {
                @foreach (var license in Model.Licenses)
                {
                    <span class="badge bg-primary me-2">@license.LicenseName</span>
                }
            }
            else
            {
                <p>未保持</p>
            }
        </div>
    </div>

    <!-- ボタン -->
    <div class="mb-4">
        <a asp-action="Index" class="btn btn-secondary">戻る</a>
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">編集</a>
        @if (User.FindFirst(ClaimTypes.NameIdentifier).Value != Model.Id.ToString())
            {
                <form method="post" asp-action="Delete" asp-route-id="Model.Id" style="display:inline;">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('本当に削除しますか？')">
                        削除
                    </button>
                </form>
            }
    </div>
</div>