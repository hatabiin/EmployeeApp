@model EmployeeApp.Models.Employee

@{
    ViewData["Title"] = "社員編集";
}

<div class="container mt-4">
    <h2>社員編集: @Model.EmployeeName</h2>
    <hr>

    <form method="post" asp-action="Edit">
        
        <input type="hidden" name="id" value="@Model.Id" />

        @if (ViewBag.Error != null)
        {
        <div class="alert alert-danger" role="alert">
            @ViewBag.Error
        </div>  
        }
        <div class="card mb-4">
            <div class="card-header">
                <h4>基本情報</h4>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="employeeName" class="form-label">氏名</label>
                    <input type="text" 
                           class="form-control" 
                           id="employeeName" 
                           name="employeeName" 
                           value="@Model.EmployeeName" 
                           required />
                </div>
                <div class="mb-3">
                    <label for="newPassword" class="form-label">新しいパスワード</label>
                    <input type="password"
                           class="form-control"
                           id="newPassword"
                           name="newPassword" />
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">新しいパスワード（確認）</label>
                    <input type="password"
                           class="form-control"
                           id="confirmPassword"
                           name="confirmPassword" />
                </div>
            </div>
        </div>

<div class="card mb-4">
    <div class="card-header">
        <h4>所属部署・課（テスト）</h4>
    </div>
    <div class="card-body">
        @{
            var currentDepartmentIds = Model.Departments.Select(d => d.Id).ToList();
            var currentDivisionIds = Model.Divisions.Select(d => d.Id).ToList();
        }
        
        @foreach (var dept in ViewBag.AllDepartments)
        {
            <div class="mb-4">
                <div class="form-check mb-2">
                    <input class="form-check-input" 
                           type="checkbox" 
                           name="departmentIds" 
                           value="@dept.Id" 
                           id="dept_@dept.Id"
                           @(currentDepartmentIds.Contains(dept.Id) ? "checked" : "") />
                    <label class="form-check-label fw-bold" for="dept_@dept.Id">
                        @dept.DepartmentName
                    </label>
                </div>
                
                <div class="row ms-3">
                    @foreach (var division in dept.Divisions)
                    {
                        <div class="col-md-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="divisionIds" 
                                       value="@division.Id" 
                                       id="div_@division.Id"
                                       @(currentDivisionIds.Contains(division.Id) ? "checked" : "") />
                                <label class="form-check-label" for="div_@division.Id">
                                    @division.DivisionName
                                </label>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>

        <div class="card mb-4">
            <div class="card-header">
                <h4>保有資格</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    @{
                        var currentLicenseIds = Model.Licenses.Select(l => l.Id).ToList();
                    }
                    
                    @foreach (var license in ViewBag.allLicenses)
                    {
                        <div class="col-md-6 col-lg-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="licenseIds" 
                                       value="@license.Id" 
                                       id="license_@license.Id"
                                       @(currentLicenseIds.Contains(license.Id) ? "checked" : "") />
                                <label class="form-check-label" for="license_@license.Id">
                                    @license.LicenseName
                                </label>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- ボタン -->
        <div class="mb-4">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>保存
            </button>
            <button type="button" onclick="history.back()" class="btn btn-secondary">キャンセル</button>
            <a asp-action="Index" class="btn btn-outline-secondary">
                <i class="fas fa-list me-2"></i>一覧に戻る
            </a>
        </div>
    </form>
</div>